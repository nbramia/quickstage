<!DOCTYPE html>
<html>
<head>
    <title>Debug Review API</title>
</head>
<body>
    <h1>Debug Review API Call</h1>
    <button id="testButton">Test Review API Call</button>
    <pre id="output"></pre>

    <script>
        const BASE_URL = '/api';
        
        async function testReviewAPI() {
            const output = document.getElementById('output');
            
            try {
                // Mock data that would be sent from the frontend
                const reviewData = {
                    reviewers: [
                        {
                            userId: "user_test_example_com",
                            userName: "Test User",
                            userEmail: "test@example.com"
                        }
                    ],
                    deadline: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(), // 7 days from now
                    notes: "Please review this snapshot"
                };
                
                output.textContent += 'Request data being sent:\n';
                output.textContent += JSON.stringify(reviewData, null, 2) + '\n\n';
                
                // Test JSON serialization locally first
                output.textContent += 'Testing local JSON.stringify():\n';
                const serialized = JSON.stringify(reviewData);
                output.textContent += 'Success: ' + serialized + '\n\n';
                
                // Test API call
                output.textContent += 'Making API call...\n';
                const response = await fetch(`${BASE_URL}/snapshots/test-snapshot-id/reviews`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(reviewData),
                    credentials: 'include'
                });
                
                output.textContent += `Response status: ${response.status}\n`;
                output.textContent += `Response headers: ${JSON.stringify(Object.fromEntries(response.headers.entries()), null, 2)}\n`;
                
                const responseText = await response.text();
                output.textContent += `Response body: ${responseText}\n`;
                
                if (!response.ok) {
                    output.textContent += `\nAPI Error: ${response.status}\n`;
                }
                
            } catch (error) {
                output.textContent += `\nError: ${error.message}\n`;
                output.textContent += `Stack: ${error.stack}\n`;
            }
        }
        
        document.getElementById('testButton').addEventListener('click', testReviewAPI);
    </script>
</body>
</html>