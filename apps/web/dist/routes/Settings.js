import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useState } from 'react';
import { Link } from 'react-router-dom';
import { useAuth } from '../contexts/AuthContext';
import { api } from '../api';
export function Settings() {
    const { user, logout, loading: authLoading } = useAuth();
    const [upgrading, setUpgrading] = useState(false);
    const [error, setError] = useState(null);
    const handleUpgrade = async () => {
        try {
            setUpgrading(true);
            setError(null);
            const response = await api.post('/billing/checkout');
            if (response.url) {
                window.location.href = response.url;
            }
            else {
                setError('No checkout URL received');
            }
        }
        catch (error) {
            console.error('Checkout error:', error);
            setError('Checkout failed');
        }
        finally {
            setUpgrading(false);
        }
    };
    const handleLogout = () => {
        logout();
    };
    if (authLoading) {
        return (_jsx("div", { className: "min-h-screen bg-gray-50 flex items-center justify-center", children: _jsxs("div", { className: "text-center", children: [_jsx("div", { className: "animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4" }), _jsx("p", { className: "text-gray-600", children: "Loading settings..." })] }) }));
    }
    if (!user) {
        return (_jsx("div", { className: "min-h-screen bg-gray-50 flex items-center justify-center", children: _jsxs("div", { className: "text-center", children: [_jsx("h2", { className: "text-2xl font-bold text-gray-900 mb-4", children: "Authentication Required" }), _jsx("p", { className: "text-gray-600 mb-6", children: "You need to be logged in to access your account settings." }), _jsx(Link, { to: "/login", className: "bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors", children: "Go to Login" })] }) }));
    }
    return (_jsxs("div", { className: "min-h-screen bg-gray-50", children: [_jsx("header", { className: "bg-white shadow-sm border-b", children: _jsx("div", { className: "max-w-7xl mx-auto px-4 sm:px-6 lg:px-8", children: _jsxs("div", { className: "flex justify-between items-center h-16", children: [_jsx("div", { className: "flex items-center", children: _jsx("h1", { className: "text-2xl font-bold text-gray-900", children: "QuickStage" }) }), _jsxs("nav", { className: "flex items-center space-x-8", children: [_jsx(Link, { to: "/dashboard", className: "text-gray-500 hover:text-gray-700 px-3 py-2 text-sm font-medium", children: "Dashboard" }), _jsx(Link, { to: "/settings", className: "text-blue-600 border-b-2 border-blue-600 px-3 py-2 text-sm font-medium", children: "Settings" }), _jsxs("div", { className: "flex items-center space-x-4", children: [_jsxs("div", { className: "text-sm text-gray-700", children: [_jsx("span", { className: "font-medium", children: user.plan === 'pro' ? 'Pro' : 'Free' }), _jsx("span", { className: "text-gray-500 ml-2", children: "Plan" })] }), _jsx("button", { onClick: handleLogout, className: "text-gray-500 hover:text-gray-700 px-3 py-2 text-sm font-medium border border-gray-300 rounded-lg hover:border-gray-400 transition-colors", children: "Sign Out" })] })] })] }) }) }), _jsxs("main", { className: "max-w-4xl mx-auto py-6 sm:px-6 lg:px-8", children: [_jsxs("div", { className: "px-4 sm:px-0 mb-8", children: [_jsx("h2", { className: "text-3xl font-bold text-gray-900", children: "Account Settings" }), _jsx("p", { className: "mt-2 text-gray-600", children: "Manage your account, plan, and preferences." })] }), error && (_jsx("div", { className: "px-4 sm:px-0 mb-6", children: _jsx("div", { className: "bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg", children: error }) })), _jsx("div", { className: "px-4 sm:px-0 mb-8", children: _jsxs("div", { className: "bg-white rounded-lg shadow p-6", children: [_jsx("h3", { className: "text-lg font-medium text-gray-900 mb-4", children: "Account Information" }), _jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4", children: [_jsxs("div", { children: [_jsx("label", { className: "block text-sm font-medium text-gray-700", children: "User ID" }), _jsx("p", { className: "mt-1 text-sm text-gray-900 font-mono", children: user.uid })] }), _jsxs("div", { children: [_jsx("label", { className: "block text-sm font-medium text-gray-700", children: "Current Plan" }), _jsx("span", { className: `inline-flex px-2 py-1 text-xs font-semibold rounded-full mt-1 ${user.plan === 'pro'
                                                        ? 'bg-purple-100 text-purple-800'
                                                        : 'bg-gray-100 text-gray-800'}`, children: user.plan === 'pro' ? 'Pro' : 'Free' })] }), _jsxs("div", { children: [_jsx("label", { className: "block text-sm font-medium text-gray-700", children: "Member Since" }), _jsx("p", { className: "mt-1 text-sm text-gray-900", children: new Date(user.createdAt).toLocaleDateString() })] }), user.lastLoginAt && (_jsxs("div", { children: [_jsx("label", { className: "block text-sm font-medium text-gray-700", children: "Last Login" }), _jsx("p", { className: "mt-1 text-sm text-gray-900", children: new Date(user.lastLoginAt).toLocaleDateString() })] }))] })] }) }), _jsx("div", { className: "px-4 sm:px-0 mb-8", children: _jsxs("div", { className: "bg-white rounded-lg shadow p-6", children: [_jsx("h3", { className: "text-lg font-medium text-gray-900 mb-4", children: "Plan Management" }), user.plan === 'free' ? (_jsxs("div", { children: [_jsx("p", { className: "text-gray-600 mb-4", children: "Upgrade to Pro for unlimited snapshots, larger file sizes, and extended expiry times." }), _jsx("button", { onClick: handleUpgrade, disabled: upgrading, className: "bg-purple-600 hover:bg-purple-700 disabled:bg-purple-400 text-white font-medium py-2 px-4 rounded-lg transition-colors", children: upgrading ? 'Processing...' : 'Upgrade to Pro' })] })) : (_jsxs("div", { children: [_jsx("p", { className: "text-green-600 font-medium mb-4", children: "\u2713 You're currently on the Pro plan" }), _jsx("p", { className: "text-gray-600 text-sm", children: "Enjoy unlimited snapshots, 100MB per snapshot, and up to 90-day expiry times." })] }))] }) }), _jsx("div", { className: "px-4 sm:px-0 mb-8", children: _jsxs("div", { className: "bg-white rounded-lg shadow p-6", children: [_jsx("h3", { className: "text-lg font-medium text-gray-900 mb-4", children: "Passkeys" }), user.passkeys && user.passkeys.length > 0 ? (_jsxs("div", { children: [_jsxs("p", { className: "text-gray-600 mb-4", children: ["You have ", user.passkeys.length, " passkey", user.passkeys.length !== 1 ? 's' : '', " registered."] }), _jsx("div", { className: "space-y-2", children: user.passkeys.map((passkey, index) => (_jsxs("div", { className: "flex items-center justify-between p-3 bg-gray-50 rounded-lg", children: [_jsxs("div", { children: [_jsxs("span", { className: "text-sm font-medium text-gray-900", children: ["Passkey ", index + 1] }), _jsxs("p", { className: "text-xs text-gray-500", children: ["Last used: ", passkey.counter, " times"] })] }), _jsx("button", { className: "text-red-600 hover:text-red-800 text-sm font-medium", children: "Remove" })] }, passkey.id))) })] })) : (_jsxs("div", { children: [_jsx("p", { className: "text-gray-600 mb-4", children: "No passkeys registered yet. You can register one from the login page." }), _jsxs(Link, { to: "/login", className: "inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500", children: [_jsx("svg", { className: "w-4 h-4 mr-2", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: _jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" }) }), "Register Passkey"] })] }))] }) }), _jsx("div", { className: "px-4 sm:px-0", children: _jsxs("div", { className: "bg-white rounded-lg shadow p-6", children: [_jsx("h3", { className: "text-lg font-medium text-gray-900 mb-4", children: "Account Actions" }), _jsxs("div", { className: "flex flex-col sm:flex-row gap-4", children: [_jsx("button", { onClick: handleLogout, className: "bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-lg transition-colors", children: "Sign Out" }), _jsx("button", { className: "bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-lg transition-colors", children: "Delete Account" })] })] }) })] })] }));
}
